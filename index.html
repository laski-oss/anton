<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Animoitu viesti + Ã¤Ã¤ni + Kelaâ€‘nappi</title>
  <meta name="description" content="Paina nappia ja katso animoitu viesti Ã¤Ã¤niefektillÃ¤. Stage-vaiheessa linkki Kela.fi-sivulle.">
  <meta name="theme-color" content="#0b1020">
  <style>
    :root{
      --bg:#0b1020; --fg:#e6eaf2; --muted:#93a0b4;
      --accent:#22d3ee; --accent2:#10b981; --accent3:#8b5cf6;
      --fs:clamp(1.6rem,4.2vw,3rem);
    }
    :root.light{
      --bg:#ffffff; --fg:#0f172a; --muted:#4b5563;
      --accent:#2563eb; --accent2:#22c55e; --accent3:#a855f7;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif;background:var(--bg);color:var(--fg)}
    a{color:var(--accent)}
    .wrap{min-height:100%;display:grid;place-items:center;padding:2rem}

    .card{
      width:min(920px,94vw);
      background:linear-gradient(180deg, rgba(255,255,255,.06), transparent 120%);
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px; padding:2rem; text-align:center;
      box-shadow:0 12px 36px rgba(0,0,0,.35); position:relative; overflow:hidden;
    }
    .row{display:flex;gap:.6rem;flex-wrap:wrap;justify-content:center;align-items:center}

    h1{margin:.2rem 0 .6rem;font-size:clamp(1.8rem,4vw,2.6rem)}
    p{margin:.25rem 0 1.1rem;color:var(--muted)}

    .btn{
      appearance:none; cursor:pointer; border:0; font-weight:700;
      padding:.85rem 1.15rem; border-radius:12px; color:#001018;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow:0 10px 24px color-mix(in oklab, var(--accent) 35%, transparent);
      transition:transform .06s ease, filter .2s ease;
    }
    .btn:active{ transform:translateY(1px) scale(.99) }
    .btn.ghost{
      background:transparent; color:var(--fg);
      border:1px solid color-mix(in oklab, var(--fg) 30%, transparent);
      box-shadow:none;
    }

    .topbar{
      position:fixed; inset: 12px 12px auto auto; display:flex; gap:.5rem; z-index:999;
    }

    /* Stage nÃ¤kyvyys */
    #stage{display:none; opacity:0; transition:opacity .6s ease}
    #stage.show{display:block; opacity:1}

    /* TekstikenttÃ¤ + animaatiot */
    .typewrap{
      font-weight:800; font-size:var(--fs); line-height:1.15; letter-spacing:.4px;
      margin:1.2rem 0 1.4rem;
      white-space:pre-wrap; overflow:hidden;
      filter: drop-shadow(0 6px 18px rgba(0,0,0,.35));
      position:relative;
    }
    .typewrap .char{
      display:inline-block; transform:translate3d(0,10px,0) scale(.95) rotate(var(--r,0deg));
      opacity:0; will-change: transform, opacity, filter;
      background:linear-gradient(90deg,#fff, #c7d2fe);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 0 24px color-mix(in oklab, var(--accent) 25%, transparent);
      filter: blur(.6px);
      animation: popIn .7s cubic-bezier(.2,.8,.2,1) forwards;
    }
    @keyframes popIn{
      60%{ opacity:1; transform:translate3d(0,-2px,0) scale(1.04); filter: blur(0) }
      100%{ opacity:1; transform:translate3d(0,0,0) scale(1) }
    }

    /* Taustapulssi stageen */
    .pulse{
      position:absolute; inset:-20%; background:
        radial-gradient(900px 600px at 15% 20%, color-mix(in oklab, var(--accent) 20%, transparent), transparent 60%),
        radial-gradient(1200px 800px at 85% 80%, color-mix(in oklab, var(--accent2) 20%, transparent), transparent 60%),
        radial-gradient(1400px 900px at 50% 0%, color-mix(in oklab, var(--accent3) 15%, transparent), transparent 60%);
      filter: blur(40px) saturate(140%);
      opacity:.25; pointer-events:none; z-index:0;
      animation: breathe 6s ease-in-out infinite;
    }
    @keyframes breathe { 50%{ transform:scale(1.03) } }

    .tip{font-size:.9rem;color:var(--muted);margin-top:.6rem}

    /* Konfetti kerros */
    .burst{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:998 }
    .dot{ position:absolute; width:9px; height:9px; border-radius:50%; opacity:.95;
          background: radial-gradient(circle at 30% 30%, #fff, var(--accent));
          transform: translate(-50%,-50%) scale(0); }

    /* VÃ¤hemmÃ¤n liikettÃ¤ -asetus */
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important }
      .typewrap .char{ opacity:1; transform:none !important; filter:none !important }
      .pulse{ display:none }
    }
  </style>
</head>
<body>
  <!-- YlÃ¤reunan napit: teema + ohitus + Ã„Ã¤net -->
  <div class="topbar">
    <button id="themeToggle" class="btn ghost" title="Vaihda teema">ðŸŒ™</button>
    <button id="skipBtn" class="btn ghost" title="Ohita animaatio">Ohita</button>
    <button id="muteBtn" class="btn ghost" title="Ã„Ã¤net pois/pÃ¤Ã¤lle">ðŸ”Š</button>
  </div>

  <main class="wrap">
    <!-- Startti -->
    <section id="start" class="card" aria-label="Startti">
      <h1>Tervetuloa</h1>
      <p>Paina nappia â€“ sen jÃ¤lkeen nÃ¤ytetÃ¤Ã¤n animoitu viesti ja kuuluu kevyt Ã¤Ã¤niefekti.</p>
      <div class="row">
        <button id="goBtn" class="btn">NÃ¤ytÃ¤ viesti</button>
      </div>
      <p class="tip">Vihje: paina myÃ¶s <strong>Enter</strong> kÃ¤ynnistÃ¤Ã¤ksesi.</p>
    </section>

    <!-- Stage -->
    <section id="stage" class="card" aria-live="polite" aria-label="Animoitu viesti">
      <div class="pulse" aria-hidden="true"></div>
      <div class="typewrap" id="type"></div>
      <div class="row" style="margin-top:.2rem">
        <button id="copyBtn" class="btn ghost">Kopioi teksti</button>
        <button id="backBtn" class="btn ghost">Takaisin alkuun</button>
        <!-- UUSI NAPPI KELAAN -->
        <button id="kelaBtn" class="btn" title="Avaa kela.fi">Siirry Kela.fi</button>
      </div>
    </section>
  </main>

  <!-- Konfetti -->
  <div class="burst" id="burst" aria-hidden="true"></div>

  <script>
    /***************
     * ASETUKSET
     ***************/
    // Vaihda tÃ¤hÃ¤n oma, asiallinen viestisi:
    const MESSAGE = "Anton â€“ tervetuloa!\\nNyt tulee nÃ¤yttÃ¤vÃ¤ animaatio ja Ã¤Ã¤nitehoste. âœ¨";
    const BASE_TYPING_DELAY = 18; // per merkki ms ennen kirjaimen animaation aloitusta (stagger)

    /***************
     * ELEMENTIT
     ***************/
    const start   = document.getElementById('start');
    const stage   = document.getElementById('stage');
    const typeEl  = document.getElementById('type');

    const goBtn   = document.getElementById('goBtn');
    const backBtn = document.getElementById('backBtn');
    const copyBtn = document.getElementById('copyBtn');
    const skipBtn = document.getElementById('skipBtn');
    const themeToggle = document.getElementById('themeToggle');
    const muteBtn = document.getElementById('muteBtn');
    const kelaBtn = document.getElementById('kelaBtn');
    const burstLayer = document.getElementById('burst');

    /***************
     * TEEMA
     ***************/
    const THEME_KEY='theme';
    const savedTheme = localStorage.getItem(THEME_KEY);
    const prefDark = matchMedia('(prefers-color-scheme: dark)').matches;
    if (savedTheme === 'light' || (!savedTheme && !prefDark)) {
      document.documentElement.classList.add('light');
      themeToggle.textContent = 'â˜€ï¸';
    } else themeToggle.textContent = 'ðŸŒ™';

    themeToggle.addEventListener('click',()=>{
      document.documentElement.classList.toggle('light');
      const isLight = document.documentElement.classList.contains('light');
      themeToggle.textContent = isLight ? 'â˜€ï¸' : 'ðŸŒ™';
      localStorage.setItem(THEME_KEY, isLight ? 'light' : 'dark');
    });

    /***************
     * Ã„Ã„NI (WebAudio) â€“ kevyt whoosh + chime
     ***************/
    let audioCtx = null, muted = false;

    function ensureAudio(){
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    function envGain(time, values){
      const g = audioCtx.createGain();
      g.gain.setValueAtTime(0, time);
      // values: [ [tOffset,gainValue], ... ]  (exp ramp for smoothness)
      values.forEach(([dt, v], i)=>{
        const t = time + dt;
        if (i===0) g.gain.linearRampToValueAtTime(v, t);
        else g.gain.exponentialRampToValueAtTime(Math.max(0.0001, v), t);
      });
      return g;
    }
    function noiseWhoosh(){
      if (muted || !audioCtx) return;
      const now = audioCtx.currentTime;
      // White noise buffer
      const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.6, audioCtx.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i=0;i<data.length;i++) data[i] = (Math.random()*2-1) * (1 - i/data.length);
      const src = audioCtx.createBufferSource(); src.buffer = buffer;

      const filter = audioCtx.createBiquadFilter();
      filter.type = 'lowpass'; filter.frequency.setValueAtTime(8000, now);
      filter.Q.value = 0.6;

      const g = envGain(now, [[0.01, 0.6],[0.25, 0.18],[0.55, 0.0001]]);
      src.connect(filter).connect(g).connect(audioCtx.destination);
      src.start();
    }
    function chime(){
      if (muted || !audioCtx) return;
      const now = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const g = envGain(now, [[0.005,0.7],[0.25,0.2],[0.5,0.0001]]);
      osc.type='sine';
      osc.frequency.setValueAtTime(880, now);
      osc.frequency.exponentialRampToValueAtTime(1320, now+0.35);
      osc.connect(g).connect(audioCtx.destination);
      osc.start(now);
      osc.stop(now+0.55);
    }
    function playFx(){
      ensureAudio(); noiseWhoosh(); chime();
    }
    muteBtn.addEventListener('click', ()=>{
      muted = !muted;
      muteBtn.textContent = muted ? 'ðŸ”‡' : 'ðŸ”Š';
      muteBtn.title = muted ? 'Ã„Ã¤net pois' : 'Ã„Ã¤net pÃ¤Ã¤llÃ¤';
    });

    /***************
     * KONFETTI
     ***************/
    function burstAt(x, y, count=30){
      burstLayer.innerHTML = '';
      for(let i=0;i<count;i++){
        const d=document.createElement('div'); d.className='dot';
        d.style.left = x+'px'; d.style.top = y+'px';
        burstLayer.appendChild(d);
        const ang=Math.random()*2*Math.PI, dist=70+Math.random()*150, t=420+Math.random()*520;
        d.animate(
          [
            { transform:'translate(-50%,-50%) scale(1)', opacity:1 },
            { transform:`translate(calc(-50% + ${Math.cos(ang)*dist}px), calc(-50% + ${Math.sin(ang)*dist}px)) scale(0.9)`, opacity:0 }
          ],
          { duration:t, easing:'cubic-bezier(.2,.6,.2,1)', fill:'forwards' }
        );
      }
      setTimeout(()=> burstLayer.innerHTML='', 1000);
    }

    /***************
     * TEKSTIN EDISTYNYT ANIMAATIO (kirjainkohtainen)
     ***************/
    function animateMessage(text){
      typeEl.innerHTML = '';
      const reduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
      const chars = [...text];
      const baseDelay = reduced ? 0 : BASE_TYPING_DELAY;

      chars.forEach((ch, i)=>{
        const span = document.createElement('span');
        span.className = 'char';
        span.textContent = ch;
        // pieni satunnainen rotaatio ja viive
        span.style.setProperty('--r', (Math.random()*2-1)*4 + 'deg');
        span.style.animationDelay = (i*baseDelay + Math.random()*30) + 'ms';
        typeEl.appendChild(span);
        if (ch === '\n') { span.style.display='block'; span.style.height='.4rem'; }
      });
    }

    /***************
     * NÃ„KYMÃ„T
     ***************/
    function showStage(skipAnim=false){
      start.style.display='none';
      stage.classList.add('show');
      if (skipAnim) {
        typeEl.textContent = MESSAGE;
      } else {
        animateMessage(MESSAGE);
      }
    }
    function showStart(){
      stage.classList.remove('show');
      start.style.display='';
      typeEl.textContent='';
    }

    /***************
     * TAPAHTUMAT
     ***************/
    goBtn.addEventListener('click', (e)=>{
      // Konfetti + Ã¤Ã¤ni + siirtymÃ¤
      const r = e.currentTarget.getBoundingClientRect();
      burstAt(r.left + r.width/2, r.top + r.height/2);
      playFx();
      showStage(false);
    });

    backBtn.addEventListener('click', showStart);

    // Enter kÃ¤ynnistÃ¤Ã¤ startista
    document.addEventListener('keydown', e=>{
      const onStart = start.style.display !== 'none';
      if (e.key === 'Enter' && onStart) goBtn.click();
    });

    // Ohita animaatio
    skipBtn.addEventListener('click', ()=>{
      playFx();
      showStage(true);
    });

    // Kopioi teksti
    copyBtn.addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(typeEl.textContent);
        copyBtn.textContent = 'Kopioitu!';
        setTimeout(()=> copyBtn.textContent='Kopioi teksti', 1200);
      }catch{ alert('Kopiointi ei onnistu tÃ¤ssÃ¤ selaimessa.'); }
    });

    // Kela-nappi â†’ avaa uuteen vÃ¤lilehteen
    kelaBtn.addEventListener('click', ()=>{
      window.open('https://www.kela.fi', '_blank', 'noopener,noreferrer');
    });
  </script>
</body>
</html>
