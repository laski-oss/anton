<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Animoitu viesti</title>
  <meta name="description" content="Paina nappia ja katso animoitu viesti." />
  <meta name="theme-color" content="#0b1020" />
  <style>
    :root{
      --bg: #0b1020; --fg: #e6eaf2; --muted:#93a0b4; --accent:#22d3ee; --accent2:#10b981;
      --fs: clamp(1.4rem, 3.8vw, 2.6rem);
    }
    :root.light{
      --bg:#ffffff; --fg:#0f172a; --muted:#4b5563; --accent:#2563eb; --accent2:#22c55e;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif;background:var(--bg);color:var(--fg)}
    a{color:var(--accent)}
    .wrap{min-height:100%;display:grid;place-items:center;padding:2rem}
    .card{
      width:min(820px, 94vw);
      background:linear-gradient(180deg, rgba(255,255,255,.06), transparent 120%);
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px; padding:2rem; text-align:center;
      box-shadow:0 12px 36px rgba(0,0,0,.35);
    }
    h1{margin:.2rem 0 .6rem;font-size:clamp(1.8rem,4.2vw,2.4rem)}
    p{margin:.25rem 0 1.1rem;color:var(--muted)}
    .row{display:flex;gap:.6rem;flex-wrap:wrap;justify-content:center;align-items:center}

    .btn{
      appearance:none; cursor:pointer; border:0; font-weight:700;
      padding:.8rem 1.1rem; border-radius:12px; color:#001018;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow:0 10px 24px color-mix(in oklab, var(--accent) 35%, transparent);
      transition:transform .06s ease, filter .2s ease;
    }
    .btn:active{ transform:translateY(1px) scale(.99) }
    .btn.ghost{
      background:transparent; color:var(--fg);
      border:1px solid color-mix(in oklab, var(--fg) 30%, transparent);
      box-shadow:none;
    }

    #stage{display:none; opacity:0; transition:opacity .5s ease}
    #stage.show{ display:block; opacity:1 }

    .typewrap{
      font-weight:800; font-size:var(--fs); line-height:1.2; letter-spacing:.4px;
      margin: 1.2rem 0 1.2rem;
      border-right:2px solid color-mix(in oklab, var(--fg) 80%, transparent);
      white-space:pre-wrap; overflow:hidden;
      background: linear-gradient(90deg, #fff, #c7d2fe);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 0 24px color-mix(in oklab, var(--accent) 25%, transparent);
      filter: drop-shadow(0 6px 18px rgba(0,0,0,.35));
      animation: caret .8s steps(1) infinite;
    }
    @keyframes caret { 50%{ border-color:transparent } }

    .topbar{
      position:fixed; inset: 12px 12px auto auto; display:flex; gap:.5rem;
      z-index:5;
    }
    .tip{font-size:.9rem;color:var(--muted);margin-top:.6rem}

    /* Konfetti */
    .burst{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:9 }
    .dot{ position:absolute; width:8px; height:8px; border-radius:50%; opacity:.95;
          background: radial-gradient(circle at 30% 30%, #fff, var(--accent));
          transform: translate(-50%,-50%) scale(0); }

    /* Prefers-reduced-motion = ei animaatioita */
    @media (prefers-reduced-motion: reduce){
      *{ animation:none !important; transition:none !important }
      .typewrap{ border-right:none }
    }
  </style>
</head>
<body>
  <!-- Yl√§napit: teema ja ohita -->
  <div class="topbar">
    <button id="themeToggle" class="btn ghost" title="Vaihda teema">üåô</button>
    <button id="skipBtn" class="btn ghost" title="Ohita animaatio">Ohita</button>
  </div>

  <main class="wrap">
    <!-- Startti -->
    <section id="start" class="card" aria-label="Startti">
      <h1>Tervetuloa</h1>
      <p>Paina nappia ‚Äì sen j√§lkeen n√§ytet√§√§n animoitu viesti.</p>
      <div class="row">
        <button id="goBtn" class="btn">N√§yt√§ viesti</button>
        <button id="shareBtn" class="btn ghost">Jaa</button>
      </div>
      <p class="tip">Vihje: paina my√∂s <strong>Enter</strong> k√§ynnist√§√§ksesi.</p>
    </section>

    <!-- Stage -->
    <section id="stage" class="card" aria-live="polite" aria-label="Animoitu viesti">
      <div class="typewrap" id="type"></div>
      <div class="row">
        <button id="copyBtn" class="btn ghost">Kopioi teksti</button>
        <button id="backBtn" class="btn ghost">Takaisin alkuun</button>
      </div>
    </section>
  </main>

  <!-- Konfetti-kerros -->
  <div class="burst" id="burst" aria-hidden="true"></div>

  <script>
    /***************
     * ASETUKSET
     ***************/
    // Vaihda t√§h√§n oma, asiallinen viesti:
    const MESSAGE = "Anton ‚Äì tervetuloa!\\nT√§m√§ on animoitu tervehdys. üòé";

    const TYPING_SPEED = 38; // ms/merkki (0 = kirjoita heti)

    /***************
     * ELEMENTIT
     ***************/
    const start   = document.getElementById('start');
    const stage   = document.getElementById('stage');
    const goBtn   = document.getElementById('goBtn');
    const backBtn = document.getElementById('backBtn');
    const copyBtn = document.getElementById('copyBtn');
    const shareBtn= document.getElementById('shareBtn');
    const skipBtn = document.getElementById('skipBtn');
    const typeEl  = document.getElementById('type');
    const themeToggle = document.getElementById('themeToggle');
    const burstLayer  = document.getElementById('burst');

    /***************
     * TEEMA
     ***************/
    const THEME_KEY = 'theme';
    const prefDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem(THEME_KEY);
    if (savedTheme === 'light' || (!savedTheme && !prefDark)) {
      document.documentElement.classList.add('light');
      themeToggle.textContent = '‚òÄÔ∏è';
    } else {
      themeToggle.textContent = 'üåô';
    }
    themeToggle.addEventListener('click', ()=>{
      document.documentElement.classList.toggle('light');
      const isLight = document.documentElement.classList.contains('light');
      themeToggle.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem(THEME_KEY, isLight ? 'light' : 'dark');
    });

    /***************
     * KIRJOITUSKONE
     ***************/
    function typeMessage(el, text, speed = TYPING_SPEED){
      el.textContent = '';
      if (speed <= 0 || window.matchMedia('(prefers-reduced-motion: reduce)').matches){
        el.textContent = text; // n√§yt√§ heti
        return;
      }
      let i = 0;
      const tick = () => {
        el.textContent = text.slice(0, i++);
        if (i <= text.length) {
          const prev = text[i-1] || '';
          setTimeout(tick, prev === "\n" ? speed * 6 : speed);
        }
      };
      tick();
    }

    /***************
     * KONFETTI
     ***************/
    function burstAt(x, y, count = 26){
      burstLayer.innerHTML = '';
      for (let i=0;i<count;i++){
        const d = document.createElement('div');
        d.className = 'dot';
        d.style.left = x + 'px';
        d.style.top  = y + 'px';
        burstLayer.appendChild(d);
        const ang = Math.random()*2*Math.PI;
        const dist = 60 + Math.random()*140;
        const t = 400 + Math.random()*500;
        d.animate(
          [
            { transform: 'translate(-50%,-50%) scale(1)', opacity: 1 },
            { transform: `translate(calc(-50% + ${Math.cos(ang)*dist}px), calc(-50% + ${Math.sin(ang)*dist}px)) scale(0.8)`, opacity: 0 }
          ],
          { duration: t, easing: 'cubic-bezier(.2,.6,.2,1)', fill: 'forwards' }
        );
      }
      setTimeout(()=> burstLayer.innerHTML='', 1000);
    }

    /***************
     * N√ÑKYM√ÑT
     ***************/
    function showStage(){
      start.style.display = 'none';
      stage.classList.add('show');
      typeMessage(typeEl, MESSAGE);
    }
    function showStart(){
      stage.classList.remove('show');
      start.style.display = '';
      typeEl.textContent = '';
    }

    /***************
     * TAPAHTUMAT
     ***************/
    goBtn.addEventListener('click', (e)=>{
      // Konfetti napin kohdalta:
      const r = e.currentTarget.getBoundingClientRect();
      burstAt(r.left + r.width/2, r.top + r.height/2);
      showStage();
    });

    backBtn.addEventListener('click', showStart);

    // Enter-n√§pp√§in k√§ynnist√§√§ startista
    document.addEventListener('keydown', e=>{
      const stageHidden = !stage.classList.contains('show');
      if (e.key === 'Enter' && stageHidden) goBtn.click();
    });

    // Ohita animaatio ‚Üí n√§yt√§ teksti heti
    skipBtn.addEventListener('click', ()=>{
      showStage();
      typeMessage(typeEl, MESSAGE, 0);
    });

    // Kopioi teksti
    copyBtn.addEventListener('click', async ()=>{
      try{
        await navigator.clipboard.writeText(typeEl.textContent);
        copyBtn.textContent = 'Kopioitu!';
        setTimeout(()=> copyBtn.textContent = 'Kopioi teksti', 1200);
      }catch{
        alert('Kopiointi ei onnistunut t√§ss√§ selaimessa.');
      }
    });

    // Jaa-nappi
    shareBtn.addEventListener('click', async ()=>{
      if (navigator.share){
        try{
          await navigator.share({ title: document.title, text: 'Katso t√§m√§!', url: location.href });
        }catch{/* peruttu */}
      }else{
        alert('Jakaminen ei ole tuettu t√§ss√§ selaimessa.');
      }
    });
  </script>
</body>
</html>
